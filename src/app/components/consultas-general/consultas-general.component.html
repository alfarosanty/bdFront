<div class="container-principal">
    <!-- Menú lateral -->
    <nav class="menu-lateral">
      <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Seleccionar filtro" class="menu-button">
        <mat-icon>more_vert</mat-icon>
      </button>
    
      <span class="menu-label">
        <mat-icon>dashboard</mat-icon>
        Vista: <strong>{{ filtroSeleccionadoTexto }}</strong>
      </span>
      
    
      <mat-menu #menu="matMenu">
        <button mat-menu-item
                *ngFor="let item of menuListItems"
                (click)="setFiltroSeleccionado(item.id)"
                class="menu-item">
          <mat-icon>{{ item.icon }}</mat-icon>
          <span>{{ item.label }}</span>
        </button>
      </mat-menu>
    </nav>


    <section [ngSwitch]="filtroSeleccionado" class="pantalla">
  
        <!-- Facturación -->
        <div *ngSwitchCase="'filtro1'" class="pantalla-contenido">
            <h2>Factura</h2>

            <div class="selector-container">
              <h2 class="titulo">Cliente</h2>
            
              <div class="cliente-formulario">
            
                <!-- Número de cliente -->
                <div class="cliente-item">
                  <label for="numCliente">Número de Cliente</label>
                  <input type="text" id="numCliente"
                         [(ngModel)]="numCliente"
                         (keydown.enter)="seleccionarXnumeroCliente()"
                         class="input-chico" />
                </div>
            
                <!-- Autocompletado de clientes -->
                <div class="cliente-item">
                  <label for="clientes">Seleccionar Cliente</label>
                  <mat-form-field class="input-mat-cliente" appearance="outline">
                    <mat-label>Seleccione un cliente...</mat-label>
                    <input type="text"
                           matInput
                           [formControl]="clienteControl"
                           [matAutocomplete]="autoCliente"
                           (input)="clienteControl.setValue(clienteControl.value?.toUpperCase(), { emitEvent: false })" />
                    <mat-autocomplete #autoCliente="matAutocomplete" autoActiveFirstOption (optionSelected)="seleccionarCliente()">
                      <mat-option *ngFor="let c of filteredClientes | async" [value]="c.razonSocial">
                        {{ c.razonSocial }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
            
              </div>
            </div>


        <div class="inferior-container">
            <h3 class="titulo">Datos del Comprobante</h3>
          
            <div class="datos-comprobante">
              
              <!-- Rango de fechas -->
              <form [formGroup]="range" class="filtro-fechas">
                <mat-form-field appearance="outline">
                  <mat-label>Seleccione rango de fechas</mat-label>
                  <mat-date-range-input [rangePicker]="picker">
                    <input matStartDate formControlName="fechaInicio" placeholder="Desde">
                    <input matEndDate formControlName="fechaFin" placeholder="Hasta">
                  </mat-date-range-input>
                  <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-date-range-picker #picker></mat-date-range-picker>
          
                  <mat-error *ngIf="range.controls.fechaInicio.hasError('matStartDateInvalid')">
                    Fecha de inicio inválida
                  </mat-error>
                  <mat-error *ngIf="range.controls.fechaFin.hasError('matEndDateInvalid')">
                    Fecha de fin inválida
                  </mat-error>
                </mat-form-field>
              </form>
          
              <!-- Tipo de factura -->
              <mat-form-field class="filtro-item">
                <mat-label>Tipo de Factura</mat-label>
                <mat-select [(ngModel)]="tipoFactura" name="tipoFactura">
                  <mat-option value="A">Factura A</mat-option>
                  <mat-option value="B">Factura B</mat-option>
                </mat-select>
              </mat-form-field>
          
              <!-- Punto de venta -->
              <mat-form-field class="filtro-item">
                <mat-label>Punto de venta</mat-label>
                <mat-select [(ngModel)]="puntoDeVenta" name="puntoDeVenta">
                  <mat-option *ngFor="let numero of puntosDeVentasPosibles" [value]="numero">
                    {{ numero }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
          
            </div>
          </div>

          <button mat-raised-button color="primary" style="margin-top: 16px;" (click)="traerFacturas()">Buscar</button>

          <table mat-table [dataSource]="dataSourceCodigoFactura" multiTemplateDataRows style="margin-top: 16px;" class="mat-elevation-z8">

            <!-- Columnas principales -->
            <ng-container matColumnDef="Factura">
              <th mat-header-cell *matHeaderCellDef>Factura(id-fecha-cliente)</th>
              <td mat-cell *matCellDef="let element">{{ element.id }} - {{element.cliente.razonSocial}} - {{element.fecha}}</td>
            </ng-container>
          
            <ng-container matColumnDef="TipoFactura">
              <th mat-header-cell *matHeaderCellDef>Tipo Factura</th>
              <td mat-cell *matCellDef="let element">
              {{element.tipoFactura}}
              </td>
            </ng-container>
          
            <ng-container matColumnDef="NumeroFactura">
              <th mat-header-cell *matHeaderCellDef>Numero Factura</th>
              <td mat-cell *matCellDef="let element">
               {{element.NumeroFactura}}
              </td>
            </ng-container>

            <ng-container matColumnDef="Cae">
                <th mat-header-cell *matHeaderCellDef>CAE</th>
                <td mat-cell *matCellDef="let element">
                {{element.cae}}
                </td>
              </ng-container>

            <ng-container matColumnDef="PuntoDeVenta">
                <th mat-header-cell *matHeaderCellDef>Punto de Venta</th>
                <td mat-cell *matCellDef="let element">
                {{element.puntoDeVenta}}
                </td>
              </ng-container>
          
            <ng-container matColumnDef="ImporteBruto">
              <th mat-header-cell *matHeaderCellDef>Importe Bruto</th>
              <td mat-cell *matCellDef="let element">
                ${{element.importeBruto}}
              </td>
            </ng-container>
          
            <ng-container matColumnDef="Iva">
              <th mat-header-cell *matHeaderCellDef>IVA</th>
              <td mat-cell *matCellDef="let element">
                ${{element.iva}}
              </td>
            </ng-container>
                
            <!-- Detalle expandible -->
            <ng-container matColumnDef="expandedDetail">
              <td mat-cell *matCellDef="let element" [attr.colspan]="facturaColumnsToDisplay.length">
                <div class="detalle-expandido mat-elevation-z2" [@detailExpand]="element === expandedElement ? 'expanded' : 'collapsed'">
                  <table mat-table [dataSource]="getArticulosParaArticulo(element.codigo)" class="mat-elevation-z1">
          
                    <!-- ARTÍCULO -->
                    <ng-container matColumnDef="Articulo">
                      <th mat-header-cell *matHeaderCellDef>Artículo</th>
                      <td mat-cell *matCellDef="let presuArt">
                        <span class="color-circle"
                              [ngStyle]="{ 'background-color': presuArt.articulo.color?.colorHexa || '#000' }">
                        </span>
                        {{ presuArt.articulo?.codigo }}
                        {{ presuArt.articulo?.color.descripcion }}
                      </td>
                    </ng-container>
                    
          
                    <!-- CANTIDAD -->
                    <ng-container matColumnDef="Cantidad">
                      <th mat-header-cell *matHeaderCellDef>Cantidad</th>
                      <td mat-cell *matCellDef="let presuArt">{{ presuArt.cantidad }}</td>
                    </ng-container>
          
                    <tr mat-header-row *matHeaderRowDef="facturaArticuloColumnsToDisplay"></tr>
                    <tr mat-row *matRowDef="let row; columns: facturaArticuloColumnsToDisplay"></tr>
                  </table>
                </div>
              </td>
            </ng-container>
          
            <!-- FILAS -->
            <tr mat-header-row *matHeaderRowDef="facturaColumnsToDisplay"></tr>
            <tr mat-row *matRowDef="let element; columns: facturaColumnsToDisplay"
            class="example-element-row"
            [class.example-expanded-row]="expandedElement === element"
            (click)="toggleExpand(element)">
            </tr>
        
            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
          
          </table>
        
        </div>
      
        <!-- Presupuesto -->
        <div *ngSwitchCase="'filtro2'" class="pantalla-contenido">
          <h2>Presupuesto</h2>
          <p>Contenido de presupuesto...</p>
        </div>
      
        <!-- Pedido de producción -->
        <div *ngSwitchCase="'filtro3'" class="pantalla-contenido">
          <h2>Pedido de Producción</h2>
          <p>Contenido de pedido de producción...</p>
        </div>
      
        <!-- Ingreso -->
        <div *ngSwitchCase="'filtro4'" class="pantalla-contenido">
          <h2>Ingreso</h2>
          <p>Contenido de ingreso...</p>
        </div>
      
        <!-- Sin filtro -->
        <div *ngSwitchDefault class="pantalla-contenido">
          <h2>Sin filtro</h2>
          <p>Seleccioná una opción del menú para comenzar.</p>
        </div>
      
      </section>
      

</div>
